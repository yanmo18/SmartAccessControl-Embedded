# 智能门禁控制器硬件原理图

## 系统框图

```
┌─────────────────┐
│   电源系统      │
│  (12V输入)      │
└────────┬────────┘
         │
         ▼
┌─────────────────┐     ┌─────────────────┐
│  电压转换      │◄────┤  备用电源      │
│  (12V→5V→3.3V)  │     │  (18650电池)    │
└────────┬────────┘     └─────────────────┘
         │
         ▼
┌─────────────────┐
│   ESP32主控    │
│  (核心控制器)   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│  通信接口      │
│  (Wi-Fi/Bluetooth│
│   Ethernet/RS485)│
└────────┬────────┘
         │
         ▼
┌─────────────────┐     ┌─────────────────┐
│  识别模块      │◄────┤  执行模块      │
│  (RFID/指纹/人脸│     │  (电锁/继电器)   │
│   /密码)        │     └─────────────────┘
└─────────────────┘
         │
         ▼
┌─────────────────┐
│  传感器模块     │
│  (门磁/防拆)    │
└─────────────────┘
```

## 核心电路设计

### 1. 电源电路

**输入**：DC 12V
**输出**：5V (外设), 3.3V (主控)

**电路组成**：
- LM2596：12V → 5V 转换
- AMS1117-3.3V：5V → 3.3V 转换
- 18650电池 + TP4056充电电路：备用电源
- 电源监控电路：过压/过流保护

**关键参数**：
- 输入电压：10-15V
- 输出电流：5V/3A, 3.3V/1A
- 备用电源：可续航4-6小时

### 2. 主控电路

**核心芯片**：ESP32-WROOM-32

**电路组成**：
- ESP32芯片
- 复位电路
- 晶振电路 (40MHz)
- 调试接口 (UART)
- 启动模式选择电路

**关键参数**：
- 工作电压：3.3V
- 工作温度：-40℃ ~ 85℃
- 功耗：深度睡眠 < 10μA

### 3. 识别模块电路

#### RFID模块 (MFRC522)
- **接口**：SPI
- **引脚**：
  - SCK → GPIO18
  - MISO → GPIO19
  - MOSI → GPIO23
  - SS → GPIO5
  - RST → GPIO4

#### 指纹模块 (AS608)
- **接口**：UART
- **引脚**：
  - TX → GPIO16
  - RX → GPIO17
  - VCC → 5V
  - GND → GND

#### 摄像头模块 (OV2640)
- **接口**：I2C + SPI
- **引脚**：
  - SDA → GPIO21
  - SCL → GPIO22
  - CS → GPIO15
  - MOSI → GPIO23
  - MISO → GPIO19
  - SCK → GPIO18

#### 密码键盘 (4×4矩阵)
- **接口**：GPIO
- **引脚**：
  - ROW1 → GPIO25
  - ROW2 → GPIO26
  - ROW3 → GPIO27
  - ROW4 → GPIO32
  - COL1 → GPIO33
  - COL2 → GPIO2
  - COL3 → GPIO0
  - COL4 → GPIO4

### 4. 执行模块电路

#### 电锁控制
- **电磁锁**：12V, 2A
- **控制电路**：
  - 继电器模块：5V控制
  - 续流二极管：保护电路
- **引脚**：GPIO13

#### 门磁传感器
- **类型**：干簧管
- **接口**：GPIO
- **引脚**：GPIO34

#### 蜂鸣器
- **类型**：有源蜂鸣器
- **电压**：5V
- **引脚**：GPIO12

#### LED指示灯
- **类型**：RGB LED
- **引脚**：
  - R → GPIO25
  - G → GPIO26
  - B → GPIO27

### 5. 通信模块电路

#### RS485通信
- **芯片**：MAX485
- **接口**：UART
- **引脚**：
  - DE/RE → GPIO14
  - DI → GPIO17
  - RO → GPIO16

#### 以太网通信
- **芯片**：LAN8720
- **接口**：RMII
- **引脚**：
  - TXD0 → GPIO19
  - TXD1 → GPIO23
  - TX_EN → GPIO22
  - RXD0 → GPIO21
  - RXD1 → GPIO18
  - CRS_DV → GPIO5
  - MDIO → GPIO25
  - MDC → GPIO26

### 6. 备用电源电路

**电池**：18650锂电池 (3.7V 2000mAh)
**充电电路**：TP4056
**保护电路**：过充/过放保护
**切换电路**：二极管隔离

## PCB设计注意事项

### 1. 布局
- 电源电路与信号电路分开
- 高频信号与低频信号分开
- 接口连接器放在边缘
- 散热考虑：LM2596、AMS1117

### 2. 布线
- 电源地线加粗 (≥2mm)
- 信号地线完整
- 高频信号阻抗控制
- 差分信号等长布线

### 3. 电磁兼容
- 电源滤波
- 信号屏蔽
- 接地良好
- 防ESD保护

### 4. 机械设计
- 安装孔位置
- 散热孔
- 接口位置
- 防水考虑

## 组件布局

| 区域 | 组件 | 位置 |
|------|------|------|
| 核心区 | ESP32, AMS1117 | 中心位置 |
| 电源区 | LM2596, 电池, 充电电路 | 左侧 |
| 识别区 | RFID, 指纹, 摄像头, 键盘 | 右侧 |
| 执行区 | 继电器, 电锁接口 | 下方 |
| 通信区 | Ethernet, RS485 | 上方 |
| 接口区 | 电源输入, 网络接口 | 边缘 |

## 调试与测试

### 1. 电源测试
- 输入电压：12V ± 10%
- 输出电压：5V ± 5%, 3.3V ± 5%
- 负载测试：满负载输出
- 备用电源：切换测试

### 2. 通信测试
- Wi-Fi：连接稳定性
- Ethernet：网络速度
- RS485：通信距离
- MQTT：消息传输

### 3. 识别测试
- RFID：读卡速度
- 指纹：识别准确率
- 人脸：识别速度
- 密码：输入响应

### 4. 执行测试
- 电锁：开锁速度
- 继电器：可靠性
- 传感器：响应时间
- 报警：声音强度

## 安全性考虑

### 1. 物理安全
- 防拆设计：防拆开关
- 防破坏：金属外壳
- 备用电源：断电续航

### 2. 电气安全
- 过压保护：TVS二极管
- 过流保护：保险丝
- 短路保护：自恢复保险丝
- 接地保护：良好接地

### 3. 通信安全
- 数据加密：AES-256
- 认证机制：设备认证
- 防篡改：数据校验

## 版本控制

| 版本 | 日期 | 变更内容 | 设计人员 |
|------|------|----------|----------|
| V1.0 | 2024-01-01 | 初始设计 | Smart Access Control Team |
| V1.1 | 2024-01-15 | 优化电源电路 | Smart Access Control Team |
| V1.2 | 2024-02-01 | 增加以太网接口 | Smart Access Control Team |

## 参考资料

1. ESP32 技术参考手册
2. LM2596 数据手册
3. AMS1117 数据手册
4. MFRC522 数据手册
5. AS608 数据手册
6. OV2640 数据手册
7. MAX485 数据手册
8. LAN8720 数据手册
